<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Cadastro | {{ app_name }}</title>
  <link rel="icon" href="/static/icons/icon-192x192.png">
  <link rel="stylesheet" href="/static/style.css"/>
  <style>
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:900px){.row{grid-template-columns:1fr}}
    .mini{opacity:.85}
    .tag{display:inline-flex;gap:.5rem;align-items:center;padding:.35rem .7rem;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08)}
    .list{margin:8px 0 0 18px}
    .list li{margin:6px 0}
  </style>
</head>
<body class="aurora-bg">
  <div class="wrap">
    <header class="topbar">
      <div>
        <h1>üë• Cadastro de Pessoas de Confian√ßa</h1>
        <p class="mini">Limite de {{ max_contacts }} contatos por sistema (para ficar r√°pido e seguro).</p>
      </div>
      <div class="top-actions">
        <button class="btn" onclick="location.href='/'">‚Üê Voltar</button>
        <button class="btn" onclick="location.href='/motorista'">Ir para Motorista</button>
        <button class="btn" onclick="location.href='/painel'">Ir para Painel</button>
      </div>
    </header>

    <main class="grid" style="grid-template-columns:1.2fr .8fr">
      <section class="card">
        <h2>Adicionar contato</h2>

        <div class="row">
          <div>
            <label class="label">Nome</label>
            <input id="name" placeholder="Ex: Salveci"/>
          </div>
          <div>
            <label class="label">Telefone</label>
            <input id="phone" placeholder="Ex: 61999999999"/>
          </div>
        </div>

        <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn btn-hot" id="btnAdd">Salvar contato</button>
          <button class="btn btn-danger" id="btnClearContacts">Limpar contatos</button>
        </div>

        <p class="mini" style="margin-top:10px">Dica: use n√∫meros (DDD + telefone). Ex.: <strong>61993962090</strong></p>
      </section>

      <section class="card">
        <h2>Contatos cadastrados</h2>
        <div class="tag">üìå Total: <span id="count">{{ contacts|length }}</span> / {{ max_contacts }}</div>

        <ul class="list" id="list">
          {% for c in contacts %}
            <li><strong>{{c.name}}</strong> ‚Äî {{c.phone}}</li>
          {% endfor %}
        </ul>

        {% if contacts|length == 0 %}
          <p class="mini">Nenhum contato cadastrado ainda.</p>
        {% endif %}
      </section>
    </main>
  </div>

<script>
  async function refresh(){
    const r = await fetch('/api/contacts');
    const j = await r.json();
    const list = document.getElementById('list');
    list.innerHTML = '';
    (j.contacts || []).forEach(c=>{
      const li = document.createElement('li');
      li.innerHTML = `<strong>${c.name}</strong> ‚Äî ${c.phone}`;
      list.appendChild(li);
    });
    document.getElementById('count').textContent = (j.contacts||[]).length;
  }

  document.getElementById('btnAdd').addEventListener('click', async ()=>{
    const name = document.getElementById('name').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const r = await fetch('/api/contacts', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({name, phone})
    });
    const j = await r.json().catch(()=>({}));
    if (!r.ok) { alert(j.error || 'Erro ao salvar'); return; }
    document.getElementById('name').value='';
    document.getElementById('phone').value='';
    await refresh();
    alert('Contato salvo!');
  });

  document.getElementById('btnClearContacts').addEventListener('click', async ()=>{
    if (!confirm('Tem certeza que deseja apagar todos os contatos?')) return;
    await fetch('/api/contacts', {method:'DELETE'});
    await refresh();
  });

  // PWA
  if ('serviceWorker' in navigator) { navigator.serviceWorker.register('/service-worker.js').catch(()=>{}); }
</script>
</body>
</html>
